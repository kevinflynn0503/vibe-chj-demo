# 漕河泾驾驶舱 — 前端重构分析

> 日期：2026-02-10
> 作者：AI 搭档
> 状态：待 FDE 确认

---

## 一、当前核心问题

### 问题 1：业务梳理不到位

**现象**：三个场景硬塞在一个 App 里用 Tab 切换，业务流看不清楚。

**根本原因**：没有从用户旅程出发设计，而是按"功能模块"堆砌页面。

具体问题：

| 问题 | 说明 |
|------|------|
| 走访 ≠ 企业库 | `/visit` 首页是企业列表，用户以为进了企业库而不是走访工具 |
| 三场景耦合 | 招商经理不需要看孵化器和政策，但被迫切 Tab |
| 流程断裂 | 背调→走访→确认→需求跟进，这条线在页面上跳来跳去 |
| 企业画像无主 | 企业画像 6 个 Tab 什么都放，不同角色看到一样的东西 |

**正确的思路**：以**用户旅程**为主线，不是以"数据表"为主线。

招商经理的一天：
```
早上打开 → 看今天要走访谁 → 准备（看背调报告）
→ 出发走访 → 回来（妙记自动提取 → 确认记录）
→ 需求分配 → 下一个企业
```

这条线应该是一气呵成的，不需要在 Tab 之间跳转。

---

### 问题 2：展示拘谨、不够大方

**现象**：满屏小卡片、密集表格、间距不够，像后台管理系统而不是现代产品。

**根本原因**：

1. **缺少英雄区/视觉焦点**：每个页面都是表格堆砌，没有层次感
2. **间距太紧**：p-4/gap-3 级别的间距，应该 p-6~p-8 / gap-5~gap-6
3. **字号太小**：13px 作为基准太小，应该 14~15px body + 28~36px 标题
4. **卡片缺少呼吸感**：padding 不够，内部元素太密
5. **没有插图/图标点缀**：纯文字+数字太枯燥

**参考风格**（用户给的 SaaS landing page）的核心特征：

```
✅ 大标题 + 副标题的层次感
✅ 充裕的 whitespace
✅ 圆润的圆角（rounded-lg ~ rounded-xl）
✅ 柔和的阴影（shadow-sm ~ shadow-md）
✅ 蓝紫渐变作为品牌色点缀
✅ 按钮有存在感（px-8 py-4 级别）
✅ 不怕留白
```

---

### 问题 3：和小北的配合不到位

**现象**：App 是独立的全屏应用，没有考虑嵌入小北平台的场景。

**关键遗漏**：

| 遗漏 | 正确做法 |
|------|---------|
| 自带导航栏 | 小北平台已有导航，App 不应自带 Tab 栏 |
| 没有 SDK Context | 应该用 `useAppManager` 获取用户身份和通信能力 |
| sendChat 只是 toast | 应该是真实的 postMessage 到小北宿主，触发 Agent |
| 没有 Realtime 监听 | AI 写入数据后，App 应该实时更新，不是手动刷新 |
| 企业画像不是公共模块 | 三个 App 应该共享同一个企业画像组件，通过 SDK 传递企业 ID |

**正确的嵌入模型**：

```
小北平台（宿主）
├── 左侧：Agent 对话区
│   - 用户输入 → Agent 执行 → Supabase 写入
│
├── 右侧：嵌入式 App（我们的 visit-app）
│   - Realtime 监听 → 自动更新 UI
│   - 点击按钮 → sendChat → Agent 执行
│   - 不需要自己的顶部导航
│
└── 底部/浮层：企业画像（点企业名弹出）
```

这意味着：
1. **App 只负责内容区**，不需要顶栏/Tab 导航
2. **三个场景 = 三个独立 App**，不是一个 App 三个 Tab
3. **导航由小北平台控制**，用户在小北里切换不同 App
4. **当前的 visit-app 应该只做客户拜访**，政策和孵化器应该是独立 App

但考虑到 Phase 4 是 Demo 阶段，我们可以先保留 Tab 导航模拟小北的 App 切换，但要在设计上明确这一点。

---

### 问题 4：走访记录不应该用表单/表格展示

**现象**：走访确认页用 textarea 展示 AI 提取的内容，走访记录用表格行展示。

**正确做法**：用 **Markdown 渲染**展示走访内容。

原因：
1. 走访记录本质是**一篇结构化文档**（关键发现、诉求、计划），不是表单字段
2. AI 从飞书妙记提取的内容天然就是 Markdown 格式
3. Markdown 展示更像"报告"，表格展示像"数据录入"
4. 确认时人工补充也应该是 Markdown 编辑，不是 textarea

改后的走访记录展示：

```markdown
# 走访记录 — 强生医疗 · 2026-01-20

**走访人**：蔡建东（产促部）
**对象**：周敏 CEO
**来源**：飞书妙记 · AI 自动提取

---

## 关键发现

- 强生计划加大外科机器人研发投入，2026年目标营收12亿
- 对漕河泾 AI 生态中心的算力平台表现出浓厚兴趣
- 希望漕河泾协助对接生物医药上下游企业

## 企业诉求

1. 希望获得算力平台的使用权限
2. 需要对接生物医药产业链的上游原材料企业

## 下一步

下周安排园发中心的同事一起去，介绍AI算力平台

---

> 🔍 赛道问题覆盖：3/3 ✅
> 📋 政策问题覆盖：1/2 ⚠️ 缺少「研发费用占比」
```

这样的展示比 textarea 好太多。

---

### 问题 5：缺少统一首页

**现象**：`/` 直接 redirect 到 `/visit`，没有全局概览。

**应该有的首页**：

```
漕河泾智能驾驶舱
├── 顶部：欢迎 + 日期 + 今日概览
├── 三个场景入口卡片（大卡片，有视觉层次）
│   ├── 🏢 客户拜访  — 3条待确认 · 5条需求待处理
│   ├── 📋 政策服务  — 12家A级 · 8家有意愿
│   └── 🚀 孵化器    — 70家在孵 · 3个待处理匹配
├── 最近动态流（跨场景）
└── 快捷操作
```

首页的价值：
1. **一眼看全局**：三个场景的关键指标一目了然
2. **入口清晰**：点哪个卡片进哪个场景
3. **驱动行动**：待办/异常优先展示
4. **给领导看**：顾总打开就能看到整体状态

---

## 二、重构方案

### 2.1 信息架构（修正版）

```
/                          ← 统一首页（概览 + 三场景入口）
│
├── /visit                 ← 客户拜访场景
│   ├── /                  ← 走访工作台（今日计划 + 待确认 + 快搜）
│   ├── /records           ← 走访记录列表
│   ├── /records/[id]      ← 走访记录详情（Markdown 渲染）
│   └── /report/[id]       ← 背调报告（企业ID）
│
├── /policy                ← 政策服务场景
│   ├── /                  ← 政策工作台
│   ├── /screening/[id]    ← 筛选报告详情
│   └── /tasks             ← 触达任务管理
│
├── /incubator             ← 孵化器场景
│   ├── /                  ← 运营概览
│   └── /match             ← 订单匹配
│
└── /enterprises           ← 公共企业画像（全局入口）
    ├── /                  ← 企业库搜索
    └── /[id]              ← 企业画像详情
        └── /report        ← 背调报告
```

### 2.2 设计风格

**核心原则**：大方、现代、有呼吸感

```yaml
色彩:
  背景: "#F8FAFC"          # 浅灰蓝底
  卡片: "#FFFFFF"           # 纯白
  品牌: "#3B82F6"           # 蓝
  渐变: "#3B82F6 → #8B5CF6" # 蓝紫渐变（点缀用）
  文字: "#0F172A / #475569 / #94A3B8"  # slate 三级

间距:
  页面: "px-8 py-8"        # 宽松
  卡片内: "p-6"            # 充裕
  组件间: "gap-6"          # 不挤

字号:
  标题: "text-3xl (30px) font-bold"
  副标题: "text-xl (20px) font-semibold"
  正文: "text-base (16px)"
  辅助: "text-sm (14px)"
  标注: "text-xs (12px)"

圆角: "rounded-xl (12px)"  # 统一大圆角
阴影: "shadow-sm 常态, shadow-md hover"
```

### 2.3 走访记录展示方案

**技术方案**：使用 `react-markdown` + `remark-gfm` 渲染 Markdown 内容。

```
走访记录页面结构：
├── 顶部元信息（企业名 · 日期 · 走访人 · 状态）
├── Markdown 内容区（AI 提取，可编辑切换）
│   ├── 关键发现
│   ├── 企业诉求
│   └── 下一步计划
├── 侧栏（覆盖度面板 — 仍保留）
└── 操作栏（确认 / 驳回 / 编辑）
```

编辑模式：点"编辑"按钮，Markdown 内容区变成 Markdown 编辑器（可以简单用 textarea + 实时预览）。

### 2.4 和小北的配合

**Phase 4（Demo）策略**：

保留 Tab 导航模拟小北切换，但：
1. 顶栏标注"这是 Demo 模式，生产环境由小北平台提供导航"
2. `sendChat` 用 toast 模拟，但保留完整的接口签名
3. mock 数据结构和 Supabase schema 完全一致
4. 预留 `sdk-context.tsx` 的 Provider 入口

**Phase 5（真实接入）**：
1. 去掉自带导航，改为小北平台控制
2. 接入 SDK Context（`useAppManager`）
3. `sendChat` 替换为真实 postMessage
4. Supabase Realtime 订阅启用

### 2.5 统一首页设计

```
┌──────────────────────────────────────────────┐
│                                              │
│  漕河泾智能驾驶舱                              │
│  2026年2月10日 · 今日概览                      │
│                                              │
│  ┌────────┐  ┌────────┐  ┌────────────┐     │
│  │ 🏢     │  │ 📋     │  │ 🚀         │     │
│  │ 客户拜访│  │ 政策服务│  │ 孵化器管理  │     │
│  │        │  │        │  │            │     │
│  │ 3 待确认│  │ 12 A级 │  │ 70 在孵    │     │
│  │ 5 待处理│  │ 8 有意愿│  │ 3 待匹配   │     │
│  │        │  │        │  │            │     │
│  │ [进入→] │  │ [进入→] │  │ [进入→]    │     │
│  └────────┘  └────────┘  └────────────┘     │
│                                              │
│  最近动态                                     │
│  ─────────                                   │
│  · 10分钟前  薛坤完成「强生医疗」走访          │
│  · 2小时前   系统生成新一轮高新初筛报告        │
│  · 昨天      PM-A 反馈「芯视科技」有申报意愿   │
│                                              │
│  快捷操作                                     │
│  ─────────                                   │
│  [搜索企业]  [生成背调]  [开始筛选]  [订单匹配] │
│                                              │
└──────────────────────────────────────────────┘
```

---

## 三、实施优先级

| 优先级 | 任务 | 工作量 | 说明 |
|--------|------|--------|------|
| P0 | 统一首页 | 0.5天 | 立即可见的改善，展示给领导 |
| P0 | 设计风格大方化 | 1天 | CSS Token + 间距 + 字号全局调整 |
| P0 | 走访记录 Markdown 化 | 0.5天 | 安装 react-markdown，重写展示组件 |
| P1 | 走访工作台重构 | 0.5天 | 从企业列表改为任务驱动 |
| P1 | 企业画像 Tab 精简 | 0.5天 | 根据上下文动态显示 Tab |
| P2 | 导航适配小北模式 | 0.5天 | 增加 Demo/Prod 切换标识 |
| P2 | sendChat 接口规范化 | 0.5天 | 保持完整签名，mock 有 loading 状态 |

**总工作量**：约 4 天，建议分两轮：
- 第一轮（2天）：首页 + 风格 + Markdown化 — 视觉上大幅改善
- 第二轮（2天）：业务流 + 小北适配 — 体验上完善

---

## 四、待 FDE 确认的决策

1. **三个场景合一还是拆三个 App？**
   - 选项 A：继续合一（Demo 阶段省事，Tab 切换模拟）
   - 选项 B：拆成 visit-app / policy-app / incubator-app（和生产一致）
   - 推荐：A（Phase 4 先合一，Phase 5 再拆）

2. **走访记录编辑方式？**
   - 选项 A：Markdown 预览 + 编辑按钮切换
   - 选项 B：Markdown 编辑器（实时预览）
   - 选项 C：保留 textarea 但增加 Markdown 渲染预览
   - 推荐：A（最简洁）

3. **首页数据来源？**
   - 选项 A：聚合三个场景的 mock 数据
   - 选项 B：独立的首页 mock 数据
   - 推荐：A（数据一致性好）

4. **设计风格确认？**
   - 参考用户提供的 SaaS landing page 风格：浅色底、蓝紫渐变、大间距、圆角
   - 是否还有其他参考？

---

## 五、附录：当前页面清单与问题

| 页面 | 路由 | 当前状态 | 核心问题 |
|------|------|---------|---------|
| 首页 | `/` | redirect 到 /visit | 没有统一首页 |
| 走访工作台 | `/visit` | 企业列表为主 | 不是走访驱动的工作台 |
| 走访记录 | `/visit/records` | 表格列表 | 缺少上下文，难以理解 |
| 走访确认 | `/visit/confirm/[id]` | textarea 编辑 | 应该 Markdown 展示 |
| 企业库 | `/enterprises` | 独立页面 | 导航中不够显眼 |
| 企业画像 | `/enterprises/[id]` | 6 个 Tab 全堆 | 信息过载，缺少角色区分 |
| 背调报告 | `/enterprises/[id]/report` | 左右分栏 | 风格可以更大方 |
| 政策工作台 | `/policy` | Dashboard 式 | 结构 OK，风格需调整 |
| 筛选详情 | `/policy/screening/[id]` | 审查表格 | 结构 OK，风格需调整 |
| 触达任务 | `/policy/tasks` | 任务表格 | 结构 OK，风格需调整 |
| 孵化器概览 | `/incubator` | 概览+表格 | 结构 OK，风格需调整 |
| 订单匹配 | `/incubator/match` | 对话+结果 | 结构 OK，风格需调整 |

---

*文档完。等待 FDE 确认方向后开始实施。*
