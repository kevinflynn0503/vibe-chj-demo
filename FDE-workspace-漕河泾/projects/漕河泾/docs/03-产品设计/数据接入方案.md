# 数据接入方案 - 漕河泾

> 日期：2026-02-09

---

## 一、数据架构总览

```
外部数据源                    上下文平台                     Supabase
┌─────────────┐             ┌──────────────┐             ┌───────────────┐
│ 企业数据库    │──dump───→  │              │──ETL───→   │ enterprises   │
│ (腾讯云)     │            │              │             │               │
├─────────────┤            │   数据接入    │             ├───────────────┤
│ 飞书妙记     │──API────→  │   & 清洗     │──写入───→   │ visit_records │
│ 飞书日历     │──API────→  │              │             │               │
│ 飞书任务     │──API────→  │              │             ├───────────────┤
│ 飞书多维表格  │──API────→  │              │             │ policy_*      │
├─────────────┤            │              │             │               │
│ 企查查API    │──API────→  │              │             ├───────────────┤
│ 天眼查API    │──API────→  │              │             │ incubator_*   │
├─────────────┤            │              │             │               │
│ 会议室系统    │──报表───→  │              │             ├───────────────┤
│ 访客系统     │──API────→  │              │             │ system_configs│
└─────────────┘            └──────────────┘             └───────────────┘
```

## 二、数据源详细方案

### 2.1 漕河泾企业数据库（核心，0.1）

| 项目 | 说明 |
|------|------|
| 数据内容 | 17000+ 企业的工商信息、年报（脱敏）、产业标签 |
| 当前状态 | 仅有 UI 浏览权限，需申请 DB 直接访问 |
| 技术栈 | 腾讯云，具体 DB 类型待确认 |
| 接入方式 | 一次性 dump + 定期增量同步（季度） |

**接入步骤**：
1. 申请 DB 只读访问权限（FDE 找卫玥玥 → 信息技术部）
2. 确认 DB 类型和表结构
3. 编写 ETL 脚本：读原库 → 清洗转换 → 写入 Supabase `enterprises` 表
4. 字段映射：原库字段 → `enterprises` 表字段
5. 增量同步：按 `updated_at` 字段定期拉取变更

**降级方案**（如无法获取 DB 权限）：
- UI 爬取：通过前端接口批量获取数据
- 手动导出：让漕河泾导出 CSV/Excel

### 2.2 飞书妙记（核心，0.1）

| 项目 | 说明 |
|------|------|
| 数据内容 | 会议录音转录文本 |
| API | 飞书开放平台 - 妙记 API |
| 接入方式 | 事件驱动（妙记完成转录后触发） |
| 频控 | 需注意飞书 API 频率限制 |

**接入步骤**：
1. 通过飞书日历 API 获取拜访日程
2. 监听妙记完成事件 / 定时轮询
3. 获取妙记转录文本
4. 根据日程时间 + 参会人匹配企业
5. 将转录文本传给走访记录 Agent 处理
6. 处理结果写入 `visit_records` 表

### 2.3 飞书日历（核心，0.1）

| 项目 | 说明 |
|------|------|
| 数据内容 | 拜访日程（时间/地点/参会人） |
| API | 飞书开放平台 - 日历 API |
| 接入方式 | 定时同步（每小时） |

### 2.4 飞书任务（0.2）

| 项目 | 说明 |
|------|------|
| 数据内容 | 走访任务、政策触达任务 |
| API | 飞书开放平台 - 任务 API |
| 接入方式 | 写入：Agent 创建任务；读取：同步任务状态 |

### 2.5 企查查/天眼查 API（0.1）

| 项目 | 说明 |
|------|------|
| 数据内容 | 企业工商信息、股权、融资、知识产权 |
| API | 企查查/天眼查商业 API |
| 接入方式 | 按需调用（Deep Research Agent 触发） |
| 成本 | 按调用量计费，需控制频次 |

**接入步骤**：
1. 注册 API 账号（使用我方已有账号）
2. 封装为标准工具供 Agent 调用
3. 设置缓存：同一企业 24 小时内不重复查询
4. 设置预算告警

### 2.6 孵化企业 BP（0.1）

| 项目 | 说明 |
|------|------|
| 数据内容 | 约 70 份 BP（PPT/PDF） |
| 接入方式 | 一次性批量导入 + 后续逐个上传 |

**接入步骤**：
1. 收集所有 BP 文件
2. 多模态模型解析 BP：提取企业名/产品/技术/市场/团队/融资
3. 结构化后写入 `incubator_enterprises` 表
4. 提供上传入口，新 BP 自动触发解析

### 2.7 会议室预约系统（0.2）

| 项目 | 说明 |
|------|------|
| 数据内容 | 会议室预约记录（时间/房间/预约人） |
| 当前状态 | 校友软件，可导出报表 |
| 接入方式 | 定期手动导出 CSV → 导入 Supabase |

**降级方案**：手动导出 + 批量导入脚本

### 2.8 访客登记系统（0.2）

| 项目 | 说明 |
|------|------|
| 数据内容 | 来访记录（访客/被访企业/来访目的/时间） |
| 当前状态 | 飞书多维表格，实时 |
| 接入方式 | 飞书多维表格 API 定时同步 |

---

## 三、数据同步策略

| 数据源 | 同步方式 | 频率 | 触发条件 |
|--------|---------|------|---------|
| 企业数据库 | 全量 dump + 增量 | 一次性 + 季度 | 手动触发 |
| 飞书妙记 | 事件驱动 | 实时 | 妙记转录完成 |
| 飞书日历 | 定时拉取 | 每小时 | 定时任务 |
| 飞书任务 | 双向同步 | 按需 | 创建/状态变更 |
| 企查查 | 按需调用 | 按需 | Agent 触发 |
| 孵化企业 BP | 批量 + 增量 | 一次性 + 入驻时 | 手动上传 |
| 会议室预约 | 手动导入 | 每周 | 运营人员操作 |
| 访客登记 | 定时拉取 | 每日 | 定时任务 |

---

## 四、数据质量保障

| 问题 | 策略 |
|------|------|
| 企业名称不统一 | 统一用全称 + 维护别名映射表 |
| 数据冲突（多源） | 优先级：走访确认 > 官方数据库 > 企查查 > deep research |
| 数据时效性 | 每条数据标注来源和获取时间 |
| AI 提取不准确 | 必须人工确认后才入企业画像 |
| 飞书 API 频控 | 设置请求队列 + 退避重试 |

---

## 五、0.1 版本最小数据集

4 月前能跑通 Demo 所需的最小数据集：

| 数据 | 数量 | 用途 | 获取方式 |
|------|------|------|---------|
| 企业基本信息 | 17000 条 | 企业画像底座 | dump 企业数据库 |
| 背调模板样例 | 5 份 | 训练背调生成质量 | 蔡建总提供 |
| 赛道 3+3 问题 | 4-6 套 | 沟通清单配置 | 赛道组长提供 |
| 高新认定规则 | 1 套 | 政策初筛 rubrics | 薛科总提供（部分已有） |
| 孵化企业 BP | 10-70 份 | 孵化企业画像 | 公台红提供 |
| 走访妙记样例 | 3 条 | 验证提取效果 | 蔡建总提供 |
| 历史申报案例 | 5-10 份 | 校准政策判断 | 薛科总提供 |
