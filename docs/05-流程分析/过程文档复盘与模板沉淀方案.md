# 过程文档复盘与 FDE-workspace-template 沉淀方案

> 日期：2026-02-11  
> 范围：漕河泾项目全部 22 份过程文档 + 30+ 轮 Prompt 的交叉分析  
> 目标：识别可复用模式，制定具体的模板改进方案，沉淀到 `FDE-workspace-template`

---

## 一、过程文档全景：漕河泾项目产出了什么

### 1.1 文档产出统计

漕河泾项目从 2026-02-09 到 2026-02-11（3 天），累计产出 22 份文档 + 6 份 memory 日记 + 1 个完整前端项目。

| 阶段 | 文档数 | 文档列表 | 质量评估 |
|------|--------|---------|---------|
| Phase 1 需求分析 | 4 | 需求分析报告、澄清问题清单、数据需求清单、需求池CSV | ⭐⭐⭐⭐⭐ 质量高，结构化好 |
| Phase 2 场景分析 | 3 | 企业走访、政策服务、孵化器管理场景分析 | ⭐⭐⭐⭐ 流程清晰，数据依赖明确 |
| Phase 3 产品设计 | 6 | 产品架构、3个App设计、Agent设计、数据接入、飞书联动 | ⭐⭐⭐ 后端详细，前端设计缺失 |
| Phase 4 Demo | 1 | 前端项目（20个页面，6个Tab） | ⭐⭐ 功能有，体验差 |
| 重构分析 | 4 | UI分析、架构分析、前端重构、角色HITL分析 | ⭐⭐⭐⭐ 问题诊断精准 |
| 深度分析 | 3 | 架构UX问题、设计偏离根因、业务流程重构 | ⭐⭐⭐⭐ 根因分析深入 |
| 改造记录 | 1 | 布局统一化改造记录 | ⭐⭐⭐⭐ 有标准有规范 |

### 1.2 关键观察：文档质量与阶段的关系

```
Phase 1-2（需求）: ⭐⭐⭐⭐⭐  ← product skill 指导充分
Phase 3（设计）:   ⭐⭐⭐      ← skill 只覆盖后端设计，前端设计无指导
Phase 4（Demo）:   ⭐⭐        ← skill 只说"用 north-app 架构"，太粗
Phase 4+（打磨）:  大量返工     ← 无 skill 支撑，纯靠人机对话迭代
```

**核心发现**：Skill 覆盖到的阶段质量高，Skill 没覆盖的阶段质量低。Phase 3→Phase 4 的转换是断崖式的——从"有方法论的结构化产出"骤变为"无指导的自由发挥"。

---

## 二、22 份过程文档的逐一复盘

### 2.1 高质量文档：值得模板化的

#### A. 需求分析报告（`02-需求分析/需求分析报告.md`）

**做得好的地方**：
- 区分了明确需求 / 隐含需求 / 伪需求（三分法）
- 每条需求标注了来源人（可追溯）
- 有跨场景共性需求汇总（数据打通视角）
- 有风险和遗漏章节（主动暴露不确定性）
- 有优先级建议（P0-P3）+ 核心路径图
- 末尾有"AI 不确定的 5 个点"

**可沉淀到模板的**：
- ✅ 已有模板 `templates/requirement-analysis-report.md`
- ⚠️ 但模板不够细：缺少"跨场景共性需求"章节、缺少"风险与遗漏"章节、缺少"AI 不确定点"章节

#### B. 澄清问题清单（`02-需求分析/澄清问题清单.md`）

**做得好的地方**：
- 所有问题都带选择项 ABC（FDE 拿着就能用）
- 每个问题有"为什么需要确认"的背景说明
- 有备注标注当前倾向和依据
- 分层：最关键的 3 个 + 其他需要确认的 + 需要收集的数据
- 末尾有"需要了解的系统现状"表格

**可沉淀到模板的**：
- ✅ 已有模板 `templates/clarification-questions.md`
- ⚠️ 模板只是空白结构，应该把漕河泾的问题模式抽象为通用模板

#### C. 场景分析（3 份）

**做得好的地方**：
- 每个场景按"用户旅程"梳理（不是按功能堆砌）
- 有完整的业务流程图
- 标注了人 vs AI 的分工
- 有数据依赖链

**可沉淀到模板的**：
- ✅ 已有模板 `templates/scenario-analysis.md`
- ⚠️ 模板缺少"人 vs AI 分工标注"和"数据依赖链"

### 2.2 中等质量文档：结构好但不够细的

#### D. App 设计方案（3 份）

**做得好的地方**：
- 有路由结构
- 有 Agent 集成说明
- 有数据模型

**做得不好的地方**：
- ❌ 没有页面组件清单（每个页面包含什么 UI 元素）
- ❌ 没有信息优先级（用户进页面第一眼看什么）
- ❌ 没有 AI 交互方式说明（AI 在页面上怎么展示）
- ❌ 没有视觉参考
- ❌ 没有角色标注（这个页面给谁用）

**这直接导致了 Phase 4 的问题**：AI 读完 App 设计文档后，只知道"有哪些路由"，不知道"页面长什么样"。

**可沉淀到模板的**：
- ✅ 已有模板 `templates/app-design-spec.md`
- 🔴 需要重大升级：增加页面组件清单、信息层级、AI 触点、角色标注、视觉参考

#### E. 产品功能架构（`03-产品设计/产品功能架构.md`）

**做得好的地方**：
- 整体架构图清晰
- 数据模型详细
- 迭代路线明确（0.1/0.2/0.3）

**做得不好的地方**：
- ❌ 没有角色-功能矩阵（哪个角色用哪个功能）
- ❌ 没有页面流转图（用户从 A 页面到 B 页面的路径）

#### F. Agent 设计汇总

**做得好的地方**：
- 每个 Agent 的输入/输出/工具/子代理都有说明
- 共用工具被提取出来

**做得不好的地方**：
- ❌ 没有和前端页面的映射关系（Agent 输出 → 前端展示什么 UI）

### 2.3 事后补救文档：问题诊断类

#### G. 重构分析文档（4 份）

这 4 份文档是在 Phase 4 Demo 效果不佳后，紧急产出的诊断文档：

| 文档 | 核心发现 | 价值 |
|------|---------|------|
| UI现状深度分析 | 20 个页面的需求覆盖矩阵，AI 能力展示评估 | 提供了"检查清单"视角 |
| 产品架构分析 | 企业画像应独立、流程应可视化、数据应图表化 | "功能视角"→"旅程视角"转变 |
| 前端重构分析 | 业务梳理不到位、展示风格不统一、与小北配合不清 | 指出了根本问题 |
| 角色与HITL分析 | 老板/员工分离、人/AI 能力边界、HITL 流水线 | 最重要的设计范式 |

**核心问题**：这些分析**都是对的**，但都是**事后补救**。如果在 Phase 3 就有这些分析框架，Phase 4 就不会出问题。

**可沉淀到模板的**：
- 🔴 这些分析框架应该前移到 Phase 3 作为**必做检查项**，而不是 Phase 4 出问题后的补救措施

#### H. 深度分析文档（3 份）

| 文档 | 触发原因 | 核心教训 |
|------|---------|---------|
| 架构与UX问题 | FDE 反馈"看不出怎么用" | App 不该有自己的全局导航，应该适配宿主 |
| 设计偏离根因 | FDE 6 条严重反馈 | 方向性偏离：不是细节打磨问题 |
| 业务流程重构 | 第 3 次重大调整 | App 只做 UI+数据展示，AI 走 sendChat |

**核心问题**：3 份深度分析 = 3 次方向调整。如果在 Phase 3 就做对，不需要这 3 次调整。

#### I. 布局统一化改造记录

**价值很高**：提炼了 PageContainer、DetailHeader、骨架屏等共享组件标准。

**核心教训**：这个标准在 Phase 4 第一天就应该建立，而不是打磨了 2 天后才"发现需要统一"。

---

## 三、Prompt 与文档的交叉分析

### 3.1 Prompt 反映了文档没有覆盖的盲区

| Prompt 主题 | 对应的文档盲区 | 说明 |
|------------|--------------|------|
| "页面太素/太花/AI廉价感" | Phase 3 没有视觉设计指导 | App 设计只写了路由和数据，没写"长什么样" |
| "导航栏在 iframe 中很奇怪" | Phase 3 没有宿主适配设计 | App 设计没有考虑嵌入 iframe 的约束 |
| "管理看板不是管理AI的" | Phase 2 缺少角色-功能矩阵 | 场景分析没有按角色拆分功能 |
| "很多地方可以提供AI分析按钮" | Phase 3 缺少 AI 触点映射 | Agent 设计和 App 设计没有对齐 |
| "企业库冲着企查查做" | Phase 3 缺少标杆参考 | App 设计没有引用标杆产品 |
| "布局不统一/切换跳动" | Phase 4 缺少布局标准 | 没有在 Demo 开始前建立共享组件 |
| "改了政策页面，mock数据没了" | Phase 4 缺少回归机制 | 没有修改后的检查流程 |

### 3.2 文档预见了但没有阻止的问题

有些问题在文档中已经被预见，但没有机制阻止它发生：

| 文档中的预见 | 实际发生了什么 | 为什么没阻止 |
|-------------|-------------|-------------|
| 需求分析报告："政策触达和走访流程的关系" | 政策和走访的边界始终模糊 | 澄清问题没得到回答就继续了 |
| 角色HITL分析："老板和员工视角分离" | 混在一起开发了 3 天 | 分析文档是事后写的，不是事前的 |
| 架构分析："App 不需要外壳导航" | 先做了全局导航，后来删掉 | 分析在 Phase 4 中期才做 |
| demo问题分析："页面设计规格缺失" | Phase 4 产出的 Demo 无灵魂 | 分析是复盘不是预防 |

### 3.3 文档没有预见的问题

| 问题 | 为什么没预见 | 应该在哪里预见 |
|------|------------|--------------|
| UI 审美反复震荡 | 没有 Design Token 概念 | Phase 3 应该有设计系统章节 |
| 页面布局不一致 | 没有共享组件标准 | Phase 4 开始应该有布局规范 |
| AI 功能页面只展示不操作 | 没有 AI 交互范式概念 | Phase 3 App设计应该有交互说明 |
| 改A坏B的回归问题 | 没有回归检查流程 | Phase 4 执行指南应该有检查步骤 |

---

## 四、FDE-workspace-template 的差距分析

### 4.1 现有模板 vs 实际需要

| 模板/文件 | 现有状态 | 漕河泾暴露的不足 | 改进方向 |
|----------|---------|-----------------|---------|
| **product SKILL.md** | 六阶段工作流完整 | Phase 3→4 转换缺少"页面设计规格" | 增加 Phase 3.5 |
| **phase3-product-design.md** | 六维度设计指导 | 只覆盖后端设计，前端设计无指导 | 增加"前端页面设计"维度 |
| **phase4-static-demo.md** | "Demo是骨架"原则 | 只说"用north-app"，太粗 | 增加质量检查清单、布局标准 |
| **app-design-spec.md** | 路由+数据+Agent | 缺页面组件清单、信息层级、AI触点 | 重大升级 |
| **scenario-analysis.md** | 业务流程模板 | 缺角色标注、人/AI分工标注 | 增加角色和AI维度 |
| **项目_template/MEMORY.md** | 项目信息+决策 | 缺"红线清单"和"审美锚点" | 增加两个关键章节 |
| **项目_template/AGENTS.md** | 阶段和规则 | 缺Phase 4执行约束 | 增加Demo阶段的具体规则 |
| **无** | — | 缺 Design Token 模板 | 新建 |
| **无** | — | 缺 AI 交互范式库 | 新建 |
| **无** | — | 缺页面设计规格模板 | 新建 |
| **无** | — | 缺 Demo 质量检查清单 | 新建 |
| **无** | — | 缺角色-功能矩阵模板 | 新建 |
| **无** | — | 缺布局组件标准 | 新建 |
| **无** | — | 缺 FDE Prompt 指南 | 新建 |

### 4.2 缺失的知识资产（漕河泾项目产生，但没有被模板化的）

| 知识资产 | 来源文档 | 价值 | 模板化难度 |
|---------|---------|------|----------|
| 需求三分法（明确/隐含/伪） | 需求分析报告 | ⭐⭐⭐⭐⭐ | 低（已有模板，补充即可） |
| 带选择项的澄清问题 | 澄清问题清单 | ⭐⭐⭐⭐⭐ | 低（已有模板，补充范例） |
| 人/AI 能力边界矩阵 | 角色HITL分析 | ⭐⭐⭐⭐⭐ | 中（需要新模板） |
| HITL 工作流设计 | 角色HITL分析 | ⭐⭐⭐⭐⭐ | 中（需要新指南） |
| 宿主适配约束 | 深度分析v3 | ⭐⭐⭐⭐ | 低（补充到north-app） |
| 共享布局组件标准 | 布局统一化记录 | ⭐⭐⭐⭐ | 低（补充到app-template） |
| 骨架屏标准 | 布局统一化记录 | ⭐⭐⭐ | 低（补充到app-template） |
| 需求覆盖矩阵 | UI现状分析 | ⭐⭐⭐⭐ | 中（需要新模板） |
| 标杆参考方法 | 设计偏离根因分析 | ⭐⭐⭐⭐ | 低（补充到phase3指南） |
| Design Token 体系 | 布局统一化+UI重构memory | ⭐⭐⭐⭐⭐ | 低（已有index.css实现） |

---

## 五、具体沉淀方案：模板改什么，怎么改

### 5.1 概览：12 项改动

| # | 改动类型 | 文件 | 变更说明 | 优先级 |
|---|---------|------|---------|--------|
| 1 | **升级** | `product/templates/app-design-spec.md` | 增加页面组件清单、信息层级、AI触点、角色标注、视觉参考 | P0 |
| 2 | **升级** | `product/guides/phase3-product-design.md` | 增加"前端页面设计"维度和角色-功能矩阵 | P0 |
| 3 | **升级** | `product/guides/phase4-static-demo.md` | 增加质量检查清单、布局标准前置、回归机制 | P0 |
| 4 | **升级** | `projects/_template/MEMORY.md` | 增加"红线清单"和"设计锚点"章节 | P0 |
| 5 | **新建** | `product/templates/page-design-spec.md` | 页面设计规格模板（组件清单+交互+AI展示） | P0 |
| 6 | **新建** | `product/templates/role-function-matrix.md` | 角色-功能矩阵模板 | P1 |
| 7 | **新建** | `product/guides/phase3.5-frontend-design.md` | Phase 3→4 之间的前端设计指南 | P0 |
| 8 | **新建** | `product/templates/demo-quality-checklist.md` | Demo 质量检查清单 | P0 |
| 9 | **新建** | `product/guides/ai-interaction-patterns.md` | AI 交互范式库 | P1 |
| 10 | **新建** | `product/guides/fde-prompt-guide.md` | FDE Prompt 写作指南 | P1 |
| 11 | **升级** | `north-app/app-template/src/index.css` | 增加 Design Token 变量 | P0 |
| 12 | **升级** | `north-app/app-template/` | 增加 PageContainer、DetailHeader 共享组件 | P0 |

### 5.2 P0 改动详细方案

#### 改动 1：升级 `app-design-spec.md`

**当前**：只有路由结构、数据模型、Agent集成、空白的页面描述。

**增加内容**：

```markdown
## 页面详细设计

### [页面名]

**目标用户**：□ 管理者  □ 一线员工  □ 共用

**信息层级**（用户从上到下依次关注什么）：
1. [最重要的信息/操作]
2. [次重要的信息]
3. [辅助信息]

**组件清单**：
| 组件 | 位置 | 数据来源 | 交互行为 |
|------|------|---------|---------|

**AI 触点**：
| 位置 | AI 功能 | 触发方式 | 结果展示 | Agent |
|------|---------|---------|---------|-------|

**视觉参考**：
- 整体布局参考：[标杆产品/页面截图描述]
- 不要的风格：[红线]
```

#### 改动 2：升级 `phase3-product-design.md`

**增加第 7 维度：前端页面设计**

```markdown
### 7. 前端页面设计（新增）

Phase 3 最容易遗漏的一步。后端 Agent 设计再完善，如果不回答
"用户在前端看到什么"，Phase 4 的 Demo 就没有灵魂。

#### 7.1 角色-功能矩阵

每个功能标注给谁用：

| 功能 | 管理者 | 一线员工 | 说明 |
|------|--------|---------|------|

#### 7.2 页面流转图

用户从进入 App 到完成核心任务的路径：

```
首页 → 我的待办 → 走访任务 → AI生成准备 → 确认并出发
                                              ↓
首页 → 企业画像 → 走访记录 → 走访详情     ← 走访后录入
```

#### 7.3 每页信息层级

使用 `templates/page-design-spec.md` 为核心页面设计信息层级。
至少覆盖：首页、每个场景的主工作台页、关键详情页。

#### 7.4 AI 触点映射

从 Agent 设计反推前端展示：

| Agent 功能 | 前端触发方式 | 前端展示方式 | 页面位置 |
|-----------|------------|------------|---------|

#### 7.5 标杆参考

为每类页面找一个标杆参考，明确"学什么"和"不学什么"：

| 页面类型 | 标杆产品 | 学什么 | 不学什么 |
|---------|---------|--------|---------|
| 工作台首页 | 飞书工作台 | 信息密度和节奏感 | 配色方案 |
| 企业画像 | 企查查 | 信息维度和展示方式 | 广告和会员推销 |
| 流程管理 | 钉钉审批 | 进度可视化 | 审批逻辑 |
```

#### 改动 3：升级 `phase4-static-demo.md`

**增加内容**：

```markdown
## Demo 开始前：必须先做的 3 件事

### 1. 建立 Design Token

在写任何页面之前，先在 `src/index.css` 中定义 CSS 变量（配色、圆角、阴影、间距）。
后续所有页面只允许引用 Token，禁止硬编码。

参考 app-template 中已有的 Design Token 定义。

### 2. 建立共享布局组件

创建 `PageContainer`（统一页面宽度/间距）和 `DetailHeader`（统一二级页面头部）。
所有页面必须使用这两个组件，禁止各自手写布局参数。

### 3. 确认宿主适配

如果 App 要嵌入宿主（如小北 iframe）：
- 不要做全局导航栏（宿主已有）
- 不要做全屏 header（占 iframe 空间）
- 导航用内容区内的胶囊/Tab，不是独立 header

---

## Demo 完成后：质量检查清单

### 视觉一致性
- [ ] 所有 Tab 页面内容宽度一致
- [ ] 所有页面使用 PageContainer 组件
- [ ] 所有二级页面使用 DetailHeader 组件
- [ ] 颜色只使用 Design Token 变量
- [ ] 圆角只使用 Token 定义的值
- [ ] 阴影只使用 Token 定义的值

### 功能完整性
- [ ] 每个页面有充足的 mock 数据（≥5 条列表数据）
- [ ] 每个 AI 功能有对应的触发按钮和结果展示
- [ ] 页面间跳转路径完整（无死链）
- [ ] 首页能清晰传达"这个产品是什么、怎么用"

### 角色分离
- [ ] 管理视图和员工视图分开（或有切换入口）
- [ ] 员工页面不展示管理指标

### AI 存在感
- [ ] AI 功能有明确的触发入口（不是隐藏的）
- [ ] AI 结果有结构化的展示（不是纯文本）
- [ ] AI 处理中有 loading/进度状态
- [ ] 人可以编辑/确认 AI 的结果（HITL）

### 回归检查
- [ ] 所有路由可正常访问
- [ ] Mock 数据在所有页面正常展示
- [ ] 无 TypeScript 编译错误
- [ ] 无运行时 console 报错
```

#### 改动 4：升级 `_template/MEMORY.md`

```markdown
## 红线清单 ❌

> FDE 明确否定过的设计决策，任何修改都不能违反。
> 每次收到 FDE 的"不要"反馈时，记录到这里。

| 日期 | 红线 | 来源 |
|------|------|------|

## 设计锚点 🎯

> 已锁定的设计决策，不轻易调整。

### 视觉风格
- 主色：
- 参考标杆：
- 不要的风格：

### 架构约束
- 宿主环境：
- 导航方式：
- 布局标准：

### 角色体系
- 管理者看到的：
- 员工看到的：
```

#### 改动 5：新建 `page-design-spec.md`

```markdown
# 页面设计规格 - [页面名]

## 基本信息

| 项目 | 说明 |
|------|------|
| 路由 | |
| 所属模块 | |
| 目标用户 | □ 管理者  □ 一线员工  □ 共用 |
| 上游页面 | 用户从哪里来 |
| 下游页面 | 用户去哪里 |

## 信息层级

> 用户进入页面时，从上到下依次关注什么？

1. **[核心操作/核心信息]** — 占页面最显眼位置
2. **[次要信息/状态概览]** — 简洁的统计或状态
3. **[主体内容]** — 列表/卡片/表格/图表
4. **[辅助信息]** — 参考资料、历史记录等

## 组件清单

| # | 组件 | 位置 | 数据来源 | 交互行为 |
|---|------|------|---------|---------|
| 1 | | 顶部 | | |
| 2 | | 中部 | | |
| 3 | | 主体 | | |
| 4 | | 底部/侧边 | | |

## AI 触点

| 位置 | AI 功能 | 交互范式 | Agent | 结果展示 |
|------|---------|---------|-------|---------|

> 交互范式参考：一键生成 / 智能推荐列表 / 异常预警+诊断 / 流程自动化+人确认

## 视觉参考

- 整体布局参考：[标杆产品名 — 学什么]
- 数据展示参考：[标杆产品名 — 学什么]
- 不要的风格：[红线]

## 交互流程

```
用户操作 1 → 页面响应
用户操作 2 → 调用 Agent → Loading → 展示结果 → 人确认
```
```

#### 改动 7：新建 `phase3.5-frontend-design.md`

```markdown
# Phase 3.5：前端设计规格（新增阶段）

> 输入：Phase 3 的 App 设计方案 + Agent 设计方案
> 输出：每个核心页面的设计规格
> 时间：Phase 3 末尾的半天（Day 7 下午）

## 为什么需要这个阶段

Phase 3 的 App 设计回答了"有哪些页面"和"后端怎么工作"，
但没有回答"页面长什么样"和"AI 在前端怎么展示"。

如果直接进入 Phase 4（Demo），AI 只能"猜"页面设计，
导致 Demo 需要大量返工。

## 必做产出

1. **角色-功能矩阵**：每个功能标注给管理者还是员工
2. **核心页面的设计规格**：使用 `templates/page-design-spec.md`
   - 至少覆盖：首页、每个场景的主工作台、关键详情页
3. **AI 触点汇总表**：从 Agent 设计 → 前端展示的映射
4. **标杆参考清单**：每类页面的标杆 + "学什么/不学什么"
5. **Design Token 初稿**：配色、圆角、阴影、间距的定义

## 执行步骤

1. 读 Phase 3 所有产出（App 设计 + Agent 设计）
2. 做角色-功能矩阵：每个功能标注 Persona
3. 为每个核心页面填写 `page-design-spec.md`
4. 从 Agent 设计反推 AI 触点映射
5. 确定标杆参考和设计红线
6. 定义 Design Token 并写入 CSS 变量
7. FDE 审查确认 → 进入 Phase 4

## HITL 交互

这个阶段 FDE 的参与度应该是最高的——因为它决定了 Demo 的方向：

- AI 产出初版 → FDE 审查每个页面的信息层级（"这个不该放这里"）
- AI 修改 → FDE 确认标杆参考（"飞书的这个布局不错"）  
- AI 更新 → FDE 锁定设计红线（"绝对不要深色模式"→ 写入 MEMORY 红线清单）
```

#### 改动 8：新建 `demo-quality-checklist.md`

```markdown
# Demo 质量检查清单

> 在 Phase 4 完成后、进入 Phase 5 之前，逐项检查。
> FDE 和 AI 各自检查一遍，不通过的不进下一阶段。

## A. 视觉一致性（5 项）

- [ ] A1: 所有页面使用统一的 PageContainer 布局组件
- [ ] A2: 所有二级页面使用统一的 DetailHeader 组件
- [ ] A3: 颜色、圆角、阴影、间距只使用 Design Token
- [ ] A4: 切换 Tab 时页面不跳动（宽度/高度一致）
- [ ] A5: 文字层级清晰（标题 > 正文 > 辅助文字）

## B. 信息架构（5 项）

- [ ] B1: 首页能在 3 秒内告诉用户"这是什么，怎么用"
- [ ] B2: 每个工作台页面有清晰的任务导向（用户进来知道做什么）
- [ ] B3: 页面间跳转路径完整，无死链
- [ ] B4: 管理者视图和员工视图已分离
- [ ] B5: 信息优先级合理（核心操作在视觉焦点位置）

## C. AI 存在感（5 项）

- [ ] C1: 每个 AI 功能有明确的触发入口
- [ ] C2: AI 处理中有 loading/进度反馈
- [ ] C3: AI 结果是结构化展示（非纯文本）
- [ ] C4: 人可以编辑/确认 AI 结果（HITL 闭环）
- [ ] C5: AI 能力是产品核心体验，不是附属按钮

## D. 数据丰度（3 项）

- [ ] D1: 每个列表至少有 5+ 条 mock 数据
- [ ] D2: 详情页信息维度丰富（不是只有名称和状态）
- [ ] D3: 有图表/可视化的地方已用数据填充

## E. 技术质量（4 项）

- [ ] E1: 所有路由可正常访问（无 404）
- [ ] E2: 无 TypeScript 编译错误
- [ ] E3: 无运行时 console.error
- [ ] E4: 移动端基本可用（响应式布局）

## 评分

- 22/22 全通过：进入 Phase 5
- 18-21 通过：修复剩余项后进 Phase 5
- < 18 通过：退回 Phase 4 继续迭代
```

### 5.3 P1 改动详细方案

#### 改动 6：新建 `role-function-matrix.md`

```markdown
# 角色-功能矩阵

## 角色定义

| 角色 | 代号 | 核心场景 | 使用频率 |
|------|------|---------|---------|
| 管理者 | M | 看数据、审批、分配 | 每周 1-2 次 |
| 一线员工 | E | 执行任务、录入数据 | 每天 |
| | | | |

## 功能矩阵

| 功能 | 管理者(M) | 员工(E) | 说明 |
|------|----------|---------|------|
| 全局统计看板 | ✅ 查看 | ❌ 不可见 | 管理者专属 |
| 我的待办 | ❌ 不需要 | ✅ 操作 | 员工日常入口 |
| 走访任务分配 | ✅ 分配 | ✅ 接收 | 管理者分配，员工执行 |
| 企业画像 | ✅ 查看 | ✅ 查看+编辑 | 共用，员工可补充 |
| AI 分析报告 | ✅ 查看 | ✅ 触发+编辑 | 员工触发，管理者查看结果 |
| | | | |

## 视图分离方案

### 方案 A：角色切换
管理者登录后看管理视图，员工看员工视图。

### 方案 B：Tab 分离
独立的"管理看板"Tab，只对管理者角色可见。

### 方案 C：同页分层
同一页面，管理者额外看到汇总数据区块。

> 选择：□ A  □ B  □ C  □ 其他
```

#### 改动 9：新建 `ai-interaction-patterns.md`

```markdown
# AI 交互范式指南

> 当 App 中需要展示 AI 能力时，从以下范式中选择合适的模式。

## 范式一：一键生成

**适用场景**：背调报告、走访提纲、匹配分析、诊断报告

**UI 模式**：
```
[AI 生成XX] 按钮 → Loading（步骤进度） → 结果卡片（可编辑） → [确认] / [重新生成]
```

**关键 UI 元素**：
- 触发按钮（明确的文案，如"AI 生成走访准备"）
- 进度展示（不只是 Spinner，是步骤：正在查询企业数据… → 正在分析行业…）
- 结果区域（结构化卡片，可折叠/展开，可编辑关键字段）
- 操作区（确认发送 / 导出 / 重新生成）

**前端 → Agent 交互**：
```
用户点击 → sendChat(prompt) → Agent 执行 → 写入 Supabase → Realtime 推送 → 前端更新
```

---

## 范式二：智能推荐列表

**适用场景**：政策匹配企业、订单匹配、合作推荐

**UI 模式**：
```
[开始AI匹配] → Loading → 推荐列表（卡片/行，带匹配度标签） → 点击查看详情 → [采纳] / [忽略]
```

**关键 UI 元素**：
- 匹配度标签（高/中/低，用颜色区分）
- AI 理由摘要（为什么推荐，1-2 句话）
- 展开详情（完整的匹配分析）
- 批量操作（全部采纳 / 筛选后采纳）

---

## 范式三：异常预警 + AI 诊断

**适用场景**：孵化器异常、政策风险、走访遗漏检测

**UI 模式**：
```
预警条/红色标记 → 点击展开 → AI 分析原因 → 建议处理措施 → [标记已处理] / [忽略]
```

**关键 UI 元素**：
- 预警入口（醒目但不打扰，红/橙色标记或数字徽标）
- 诊断结果（原因分析 + 严重程度）
- 处理建议（AI 推荐的下一步）
- 状态流转（待处理 → 已处理 → 已关闭）

---

## 范式四：流程自动化 + 人确认（HITL）

**适用场景**：触达任务分发、走访记录审核、需求分配

**UI 模式**：
```
AI 自动完成 → 状态标记"待确认" → 人审阅 → [确认] / [修改后确认] / [退回]
```

**关键 UI 元素**：
- 自动完成标记（"AI 已自动分配 12 个任务"）
- 待确认队列（集中展示所有待人确认的 AI 操作）
- 对比视图（AI 的操作 vs 原始数据）
- 批量确认（效率优先）

---

## 范式选择指南

| 场景特征 | 推荐范式 |
|---------|---------|
| 输入明确，输出是一份文档/报告 | 一键生成 |
| 从大量数据中找匹配项 | 智能推荐列表 |
| 监控数据，发现异常 | 异常预警+诊断 |
| AI 可以自动完成，但需要人兜底 | 流程自动化+人确认 |
```

#### 改动 10：新建 `fde-prompt-guide.md`

```markdown
# FDE Prompt 写作指南

> 如何给 AI 写 Prompt 才能减少返工？基于漕河泾项目 30+ 轮的经验总结。

## 核心原则

1. **一次一个目标**：不要在一条 prompt 里塞 8 个问题
2. **说清楚"为什么不对"**：不只说"不好"，要说"哪里不好、为什么不好"
3. **给验收标准**：改完后怎么算"好了"
4. **标注优先级**：哪个最重要、哪个后面再说

## Prompt 模板

### 修 Bug / 修问题

```
## 问题
[描述现象，最好附截图]

## 期望
[应该是什么样]

## 影响范围
[只改这个文件 / 涉及多个文件]

## 注意
[不要改 XX / 保持 YY 不变]
```

### 优化 UI

```
## 要优化的页面
[页面名 + 路由]

## 问题
1. [具体问题]
2. [具体问题]

## 参考
[参考哪个产品的哪个页面，学什么]

## 红线
[不要什么：不要深色、不要渐变、不要大阴影...]

## 验收标准
- [ ] [标准1]
- [ ] [标准2]
```

### 新增功能

```
## 功能描述
[做什么]

## 用户场景
[谁在什么情况下用这个功能]

## 交互流程
[用户操作 → 系统响应 → 结果展示]

## 约束
[用什么组件 / 不要什么 / 和现有页面保持一致]
```

## 反面案例

| 不好的 Prompt | 问题 | 改进后 |
|-------------|------|--------|
| "首页还是没有优化" | 不知道要优化什么 | "首页的问题：1.数据卡片太大占满屏 2.缺少今日待办入口 3.AI能力不突出" |
| "政策服务比较乱" | 不知道哪里乱 | "政策服务的问题：进入后看不到工作流程，只有数据看板和列表，缺少操作引导" |
| "参考飞书" | 不知道学什么 | "参考飞书工作台的Tab式导航和信息密度，但配色用我们自己的" |
| "优化一下" | 无验收标准 | "优化后需要满足：1.Tab切换不跳动 2.所有卡片圆角统一 3.无阴影" |
```

---

## 六、改动优先级与实施计划

### Phase 1（立即执行，1 天）

| # | 改动 | 说明 |
|---|------|------|
| 1 | 升级 `app-design-spec.md` | 增加页面组件清单、AI触点、角色标注 |
| 3 | 升级 `phase4-static-demo.md` | 增加质量检查清单、布局标准前置 |
| 4 | 升级 `_template/MEMORY.md` | 增加红线清单和设计锚点 |
| 5 | 新建 `page-design-spec.md` | 页面设计规格模板 |
| 8 | 新建 `demo-quality-checklist.md` | 质量检查清单 |

### Phase 2（本周内，2 天）

| # | 改动 | 说明 |
|---|------|------|
| 2 | 升级 `phase3-product-design.md` | 增加前端设计维度 |
| 7 | 新建 `phase3.5-frontend-design.md` | 前端设计指南 |
| 11 | 升级 `north-app/app-template` CSS | Design Token |
| 12 | 升级 `north-app/app-template` 组件 | PageContainer 等 |

### Phase 3（下周，2 天）

| # | 改动 | 说明 |
|---|------|------|
| 6 | 新建 `role-function-matrix.md` | 角色-功能矩阵 |
| 9 | 新建 `ai-interaction-patterns.md` | AI 交互范式库 |
| 10 | 新建 `fde-prompt-guide.md` | Prompt 写作指南 |

---

## 七、预期效果

### 用漕河泾项目验证：如果有了这些改动，哪些问题可以避免？

| 原始问题 | 涉及的改动 | 可避免程度 |
|---------|-----------|----------|
| Phase 4 Demo 无灵魂 | #5 页面设计规格 + #7 Phase 3.5 | 90% — 有了页面规格，AI 知道"长什么样" |
| UI 审美反复震荡 | #11 Design Token + #4 MEMORY红线 | 80% — Token 锁定 + 红线不违反 |
| 布局不一致/切换跳动 | #12 共享组件 + #3 Phase4布局标准 | 95% — 有组件约束就不会各写各的 |
| AI 功能看不到 AI | #9 AI交互范式 + #1 App设计AI触点 | 85% — 有范式就不会只做 CRUD |
| 角色混淆 | #6 角色矩阵 + #1 App设计角色标注 | 90% — 设计时就分好 |
| 改A坏B | #8 质量检查清单 + #3 回归机制 | 70% — 有检查就能发现 |
| FDE 反复重复同一反馈 | #10 Prompt指南 + #4 红线清单 | 75% — 精准Prompt + 记住红线 |

### 量化预期

| 指标 | 漕河泾项目（无改动） | 下一个项目（有改动） |
|------|-------------------|-------------------|
| Phase 4 返工轮次 | 15+ 轮 | 3-5 轮 |
| 重复反馈率 | 64% | < 20% |
| 布局修复次数 | 3 次 | 0 次 |
| 审美方向调整 | 5 次 | 1 次 |
| 回归 Bug | 4 次 | 0-1 次 |
| Phase 3→Demo 可用天数 | 0.5天设计 + 2天Demo + 3天打磨 | 1天设计 + 1.5天Demo + 0.5天微调 |

---

## 附录：漕河泾文档 → 模板改进的完整映射表

| 漕河泾文档 | 暴露的问题 | 对应模板改动 |
|-----------|-----------|-------------|
| 需求分析报告 | 质量高，可直接复用模式 | 补充模板章节（跨场景共性、风险遗漏、AI不确定点） |
| 澄清问题清单 | 质量高，带选择项的问题格式好 | 补充模板范例 |
| 场景分析（3份） | 缺角色标注和人/AI分工 | 升级场景分析模板 |
| App设计（3份） | 只有路由和数据，无页面视觉设计 | 升级App设计模板（P0） |
| Agent设计 | 好，但和前端脱节 | phase3增加AI触点映射 |
| 产品功能架构 | 缺角色-功能矩阵 | 新建角色矩阵模板 |
| UI现状分析 | 需求覆盖矩阵有价值 | 纳入质量检查清单 |
| 角色HITL分析 | 核心的AI交互设计思路 | 新建AI交互范式指南 |
| 架构UX分析 | 宿主适配和导航设计 | 补充到phase4指南 |
| 设计偏离根因分析 | 方向性偏离的诊断框架 | 补充到phase3.5指南 |
| 业务流程重构 | sendChat模式和App定位 | 补充到north-app SKILL |
| 布局统一化记录 | 共享组件标准 | 补充到app-template |
| demo问题分析 | Phase 3→4 转译缺失的根因 | 新建phase3.5 + 升级phase4 |
| MEMORY日记（5份） | Design Token迭代过程 | 纳入Design Token模板 |

---

*本文档作为漕河泾项目的方法论复盘，所有改进方案可直接落地到 `FDE-workspace-template` 中。*
