# 布局统一化改造记录

> 日期：2026-02-11
> 范围：vibe-chj-demo 全站布局体系

---

## 一、改造背景

切换顶部导航 Tab 时页面跳动严重，各 Tab 页面内容宽度不一致，二级详情页风格也各不相同。根因是每个页面各自手写布局参数，缺少统一标准。

### 改造前的问题

| 问题 | 表现 |
|------|------|
| Tab 切换跳动 | 导航栏用 `sticky` + `-mt-1` hack，各页面外层容器不统一（`min-h-full` / `min-h-screen` / `h-full flex-col`），切换时布局结构剧变 |
| 内容宽度不一致 | 各页面手写 `max-w-[1200px] mx-auto px-4 sm:px-6`，微妙差异导致宽度跳动 |
| 头部风格不统一 | 部分页面用卡片包裹（border + shadow），首页用轻量标题行，视觉风格割裂 |
| 二级页面混乱 | 各用 `min-h-screen`，头部各写各的 `bg-white border-b` + 内联宽度 |

---

## 二、改造方案

### 核心思路：三层统一

```
Portal Layout（固定层）
  ├── 导航栏（shrink-0，不参与滚动）
  └── 内容区（flex-1，overflow-y-auto）
        ├── Tab 页面（page-container + 统一头部风格）
        └── 二级页面（detail-header + page-container）
```

---

## 三、具体改动

### 3.1 Portal Layout 重构

**文件**：`src/app/(portal)/layout.tsx`

| 改造点 | 之前 | 之后 |
|--------|------|------|
| 外层容器 | `h-screen overflow-y-auto` | `h-screen flex flex-col` |
| 导航栏 | `sticky top-0` + `pointer-events-none` | `shrink-0`（固定高度，不参与滚动） |
| 内容区 | `<main className="-mt-1">` | `<main className="flex-1 overflow-y-auto overflow-x-hidden">` |

**效果**：导航栏完全固定，切换 Tab 时零跳动。

### 3.2 统一 CSS 工具类

**文件**：`src/index.css`（已有，本次未修改，各页面开始实际使用）

| 类名 | 作用 | 参数来源 |
|------|------|----------|
| `.page-container` | 所有页面内容容器 | `--page-max-w: 1200px` / `--page-px: 1rem` / `--page-py: 1rem` |
| `.detail-header` | 二级页面白底头部栏 | `bg-white` + `border-bottom` |
| `.detail-header-inner` | 头部栏内容居中 | 与 `.page-container` 相同的 max-width 和 padding |

**核心价值**：未来调整布局，只需修改 CSS 变量 `--page-max-w` / `--page-px`，一处改全局生效。

### 3.3 六个 Tab 页面统一

全部改为：

```tsx
<div className="min-h-full">
  <div className="page-container space-y-4">
    {/* 头部 — 轻量标题行 */}
    <div className="flex items-center justify-between pt-1">
      <div>
        <h1 className="text-base font-bold text-slate-900">页面标题</h1>
        <p className="text-xs text-slate-400 mt-0.5">描述文字</p>
      </div>
      <div>{/* 操作按钮 */}</div>
    </div>
    {/* 内容区 */}
    ...
  </div>
</div>
```

| 页面 | 改动 |
|------|------|
| 工作台 `/` | 外层 `min-h-full`，内层改用 `.page-container`（之前内联 `max-w-[1200px]`） |
| 客户拜访 `/visit` | 去掉 flex-col 分割布局 + 卡片头部 → 统一 page-container + 轻量标题行 |
| 政策服务 `/policy` | `min-h-screen` → `min-h-full`，卡片头部 → 轻量标题行 |
| 孵化管理 `/incubator` | 同上 |
| 企业库 `/enterprises` | 同上 |
| 数据看板 `/dashboard` | 同上 |

### 3.4 二级详情页统一

全部 12+ 个二级页面执行：

1. 外层 `min-h-screen` → `min-h-full`
2. 头部区域：内联 `bg-white border-b` + `max-w-[1200px]` → `.detail-header` + `.detail-header-inner`
3. 内容区域：内联 `max-w-[1200px] mx-auto px-4 sm:px-6` → `.page-container`

涉及文件：

- `visit/[id]/page.tsx`
- `visit/confirm/[id]/page.tsx`
- `visit/records/page.tsx`
- `visit/[id]/follow/page.tsx`
- `enterprises/[id]/page.tsx`
- `enterprises/[id]/report/page.tsx`
- `policy/screening/page.tsx`
- `policy/screening/[id]/page.tsx`
- `policy/diagnosis/[id]/page.tsx`
- `policy/tasks/page.tsx`
- `incubator/[id]/page.tsx`
- `incubator/alerts/page.tsx`
- `incubator/match/page.tsx`
- `incubator/recommend/page.tsx`

### 3.5 移除骨架屏 loading.tsx

初始方案为每个路由添加了骨架屏 `loading.tsx`，但实际效果是页面切换时闪烁白屏骨架，反而让人感觉更卡。全部移除：

- 删除 12 个 `loading.tsx` 文件
- 保留 `src/components/ui/Skeleton.tsx` 组件（未来按需手动使用）

---

## 四、统一后的布局规范

### Tab 工作台页面

```
┌─────────────────────────────────────────┐
│         浮动胶囊导航（shrink-0）          │
├─────────────────────────────────────────┤
│  ┌─ page-container (max-w: 1200px) ──┐  │
│  │                                    │  │
│  │  h1 标题        [操作按钮]         │  │
│  │  描述文字                          │  │
│  │                                    │  │
│  │  ┌── 内容卡片 ──┐ ┌── 卡片 ──┐    │  │
│  │  │              │ │          │    │  │
│  │  └──────────────┘ └──────────┘    │  │
│  │                                    │  │
│  └────────────────────────────────────┘  │
│              (flex-1 滚动区)              │
└─────────────────────────────────────────┘
```

### 二级详情页面

```
┌─────────────────────────────────────────┐
│         浮动胶囊导航（shrink-0）          │
├─────────────────────────────────────────┤
│  ┌─ detail-header (全宽白底 border-b) ─┐ │
│  │  ┌─ detail-header-inner (1200px) ─┐ │ │
│  │  │  ← 返回                        │ │ │
│  │  │  标题 + 信息         [操作按钮] │ │ │
│  │  └────────────────────────────────┘ │ │
│  └─────────────────────────────────────┘ │
│  ┌─ page-container (1200px) ──────────┐  │
│  │  内容区                             │  │
│  └────────────────────────────────────┘  │
└─────────────────────────────────────────┘
```

---

## 五、开发规范（后续新增页面请遵守）

1. **Tab 页面**：外层 `min-h-full` → 内层 `page-container space-y-4` → 头部用 `h1` + 描述 + 操作按钮
2. **二级页面**：外层 `min-h-full` → `detail-header` + `detail-header-inner` 头部 → `page-container space-y-N` 内容
3. **禁止**手写 `max-w-[1200px] mx-auto px-4 sm:px-6`，统一用 `.page-container` 类
4. **禁止**在 Tab 页面头部使用卡片包裹（border + shadow），保持轻量标题行风格
5. 如需调整全局宽度/间距，修改 `index.css` 中的 CSS 变量 `--page-max-w` / `--page-px` / `--page-py`
